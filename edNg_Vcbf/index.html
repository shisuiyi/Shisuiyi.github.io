<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>不予の测试笔记</title>
<meta name="description" content="<font color=#339999 size=3 >小小Tester的学习历程</font>" />
<link rel="shortcut icon" href="https://Shisuiyi.github.io/favicon.ico?v=1639829654113">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">

<link rel="stylesheet" href="https://Shisuiyi.github.io/styles/main.css">



  </head>
  <body>
    <div id="app" class="main px-4 flex flex-col lg:flex-row">
      <div id="sidebar" class="sidebar-wrapper lg:static lg:w-1/4">
  <div class="lg:sticky top-0">
    <div class="sidebar-content">
      <div class="flex lg:block p-4 lg:px-0 items-center fixed lg:static lg:block top-0 right-0 left-0 bg-white z-50">
        <i class="ri-menu-2-line lg:mt-4 text-2xl cursor-pointer animated fadeIn" onclick="openMenu()"></i>
        <a href="https://Shisuiyi.github.io">
          <img class="animated fadeInLeft avatar rounded-lg mx-4 lg:mt-32 lg:mx-0 mt-0 lg:w-24 lg:h-24 w-12 w-12" src="https://Shisuiyi.github.io/images/avatar.png?v=1639829654113" alt="">
        </a>
        <h1 class="animated fadeInLeft lg:text-4xl font-extrabold lg:mt-8 mt-0 text-xl" style="animation-delay: 0.2s">不予の测试笔记</h1>
      </div>
      
        <div class="animated fadeInLeft" style="animation-delay: 0.4s">
          <p class="my-4 text-gray-600 font-light hidden lg:block">
            文章目录
          </p>
          <div class="toc-container hidden lg:block">
            <ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90">一、持续集成</a>
<ul>
<li><a href="#1-%E4%BB%80%E4%B9%88%E6%98%AFcicd">1. 什么是CI/CD</a></li>
<li><a href="#2-jenkins">2. jenkins</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-jenkins%E5%85%A5%E9%97%A8">二、jenkins入门</a>
<ul>
<li><a href="#1-%E5%AE%89%E8%A3%85">1. 安装</a>
<ul>
<li><a href="#11-java%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85">1.1 java运行环境安装</a>
<ul>
<li><a href="#111-jdk%E5%AE%89%E8%A3%85">1.1.1 jdk安装</a></li>
<li><a href="#112-java%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE">1.1.2 java环境变量设置</a></li>
</ul>
</li>
<li><a href="#12-jenkins%E5%AE%89%E8%A3%85">1.2 jenkins安装</a>
<ul>
<li><a href="#121-windows%E7%B3%BB%E7%BB%9F%E4%B8%8B%E5%AE%89%E8%A3%85">1.2.1 windows系统下安装</a></li>
<li><a href="#122-mac%E4%B8%8B%E5%AE%89%E8%A3%85">1.2.2 mac下安装</a></li>
<li><a href="#123-%E8%84%9A%E6%9C%AC%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85">1.2.3 脚本方式安装</a></li>
<li><a href="#124-%E5%82%BB%E7%93%9C%E8%84%9A%E6%9C%AC%E5%BC%8F">1.2.4 傻瓜脚本式</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#2-jenkins%E4%BD%BF%E7%94%A8">2. jenkins使用</a></li>
<li><a href="#21-%E8%A7%A3%E9%94%81-jenkins">2.1 解锁 Jenkins</a></li>
<li><a href="#22-%E5%AE%89%E8%A3%85%E6%8F%92%E4%BB%B6">2.2 安装插件</a></li>
<li><a href="#23-%E5%88%9B%E5%BB%BA%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%AE%A1%E7%90%86%E5%91%98%E7%94%A8%E6%88%B7">2.3 创建第一个管理员用户</a></li>
<li><a href="#24-%E9%85%8D%E7%BD%AE-jenkins-url">2.4 配置 Jenkins URL</a></li>
</ul>
</li>
<li><a href="#3-%E9%85%8D%E7%BD%AE%E6%8F%92%E4%BB%B6%E5%8D%87%E7%BA%A7%E7%AB%99%E7%82%B9%E5%9B%BD%E5%86%85%E9%95%9C%E5%83%8F">3. 配置插件升级站点国内镜像</a></li>
<li><a href="#4-%E5%88%9B%E5%BB%BA-python-%E8%87%AA%E5%8A%A8%E5%8C%96%E9%A1%B9%E7%9B%AE">4. 创建 python 自动化项目</a>
<ul>
<li><a href="#41-%E6%96%B0%E5%BB%BA-item">4.1 新建 item</a></li>
<li><a href="#42-general-%E9%85%8D%E7%BD%AE">4.2 General 配置</a></li>
<li><a href="#43-%E6%BA%90%E7%A0%81%E7%AE%A1%E7%90%86">4.3 源码管理</a></li>
<li><a href="#44-%E6%9E%84%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8">4.4 构建触发器</a></li>
<li><a href="#45-%E6%9E%84%E5%BB%BA%E7%8E%AF%E5%A2%83">4.5 构建环境</a></li>
<li><a href="#46-%E6%9E%84%E5%BB%BA">4.6 构建</a></li>
</ul>
</li>
<li><a href="#5-%E9%85%8D%E7%BD%AE-html-%E6%8A%A5%E5%91%8A">5. 配置 HTML 报告</a>
<ul>
<li><a href="#51-%E5%AE%89%E8%A3%85-html-publisher-%E6%8F%92%E4%BB%B6">5.1 安装 HTML Publisher 插件</a></li>
<li><a href="#52-%E9%85%8D%E7%BD%AE-html-publisher-%E6%8F%92%E4%BB%B6">5.2 配置 HTML Publisher 插件</a></li>
<li><a href="#53-%E6%9F%A5%E7%9C%8B-html-%E6%8A%A5%E5%91%8A">5.3 查看 HTML 报告</a></li>
<li><a href="#54-%E9%85%8D%E7%BD%AE-csp">5.4 配置 csp</a>
<ul>
<li><a href="#541-%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%86%B3">5.4.1 临时解决</a></li>
<li><a href="#542-%E6%B0%B8%E4%B9%85%E8%A7%A3%E5%86%B3">5.4.2 永久解决</a></li>
<li><a href="#543-%E9%80%9A%E8%BF%87-jenkins-%E6%8F%92%E4%BB%B6%E5%AE%9E%E7%8E%B0">5.4.3 通过 jenkins 插件实现</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#6-%E9%85%8D%E7%BD%AE%E9%82%AE%E4%BB%B6">6. 配置邮件</a>
<ul>
<li><a href="#61-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E5%91%98%E9%82%AE%E7%AE%B1">6.1 配置管理员邮箱</a></li>
<li><a href="#62-%E9%85%8D%E7%BD%AE-jenkins-%E9%BB%98%E8%AE%A4%E9%82%AE%E4%BB%B6%E9%80%9A%E7%9F%A5">6.2 配置 jenkins 默认邮件通知</a></li>
<li><a href="#63-%E9%85%8D%E7%BD%AE-email-extension-plugin">6.3 配置 Email Extension Plugin</a></li>
<li><a href="#64-%E5%9C%A8%E9%A1%B9%E7%9B%AE%E4%B8%AD%E9%85%8D%E7%BD%AE%E5%8F%91%E9%80%81%E9%82%AE%E4%BB%B6">6.4 在项目中配置发送邮件</a></li>
<li><a href="#65-%E5%8F%91%E9%80%81-html-%E6%A0%BC%E5%BC%8F%E5%86%85%E5%AE%B9%E7%9A%84%E9%82%AE%E4%BB%B6">6.5 发送 HTML 格式内容的邮件</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      
    </div>
  </div>
</div>

<div class="menu-container">
  <i class="ri-arrow-left-line text-2xl cursor-pointer animated fadeIn close-menu-btn" onclick="closeMenu()"></i>
  <div>
    
      
        <a href="/" class="menu" style="animation-delay: 0s">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu" style="animation-delay: 0.2s">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu" style="animation-delay: 0.4s">
          标签
        </a>
      
    
      
        <a href="https://Shisuiyi.github.io/about" class="menu" style="animation-delay: 0.6000000000000001s" target="_blank">
          关于
        </a>
      
    
  </div>
  <div class="site-footer">
    <div class="py-4 text-gray-700">Powered by <a href="https://github.com/shisuiyi" target="_blank">shisuiyi</a></div>
    <a class="rss" href="https://Shisuiyi.github.io/atom.xml" target="_blank">RSS</a>
  </div>
</div>
<div class="mask" onclick="closeMenu()">
</div>
      <div class="content-wrapper py-32 lg:p-8 lg:w-3/4 post-detail animated fadeIn">
        <h1 class="text-3xl font-bold lg:mt-16">持续集成与jenkins</h1>
        <div class="text-sm text-gray-700 lg:my-8">
          2021-12-18 / 16 min read
        </div>
        
          <img class="post-feature-image rounded-lg mx-auto my-4" src="https://Shisuiyi.github.io/post-images/edNg_Vcbf.jpg" alt="">
        
        <div class="post-content yue">
          <h2 id="一-持续集成">一、持续集成</h2>
<h3 id="1-什么是cicd">1. 什么是CI/CD</h3>
<p>缩略词 CI / CD 具有几个不同的含义。CI/CD 中的“CI”始终指持续集成，它属于开发人员的自动化流程。成功的 CI 意味着应用代码的新更改会定期构建、测试并合并到共享存储库中。该解决方案可以解决在一次开发中有太多应用分支，从而导致相互冲突的问题。</p>
<p>CI/CD 中的“CD”指的是持续交付和/或持续部署，这些相关概念有时会交叉使用。两者都事关管道后续阶段的自动化，但它们有时也会单独使用，用于说明自动化程度。</p>
<p>持续交付通常是指开发人员对应用的更改会自动进行错误测试并上传到存储库（如 GitHub 或容器注册表），然后由运维团队将其部署到实时生产环境中。这旨在解决开发和运维团队之间可见性及沟通较差的问题。因此，持续交付的目的就是确保尽可能减少部署新代码时所需的工作量。</p>
<p>持续部署（另一种“CD”）指的是自动将开发人员的更改从存储库发布到生产环境，以供客户使用。它主要为了解决因手动流程降低应用交付速度，从而使运维团队超负荷的问题。持续部署以持续交付的优势为根基，实现了管道后续阶段的自动化。</p>
<figure data-type="image" tabindex="1"><img src="https://Shisuiyi.github.io/post-images/1639801538029.png" alt="" loading="lazy"></figure>
<p>CI/CD 既可能仅指持续集成和持续交付构成的关联环节，也可以指持续集成、持续交付和持续部署这三项构成的关联环节。更为复杂的是，有时“持续交付”也包含了持续部署流程。</p>
<p>归根结底，我们没必要纠结于这些语义，您只需记得 CI/CD 其实就是一个流程（通常形象地表述为管道），用于实现应用开发中的高度持续自动化和持续监控。因案例而异，该术语的具体含义取决于 CI/CD 管道的自动化程度。许多企业最开始先添加 CI，然后逐步实现交付和部署的自动化。</p>
<h3 id="2-jenkins">2. jenkins</h3>
<p>Jenkins是一款开源 CI&amp;CD 软件，用于自动化各种任务，包括构建、测试和部署软件。</p>
<h2 id="二-jenkins入门">二、jenkins入门</h2>
<h3 id="1-安装">1. 安装</h3>
<h4 id="11-java运行环境安装">1.1 java运行环境安装</h4>
<h5 id="111-jdk安装">1.1.1 jdk安装</h5>
<p>jenkins是一个java项目，所以需要先安装java环境，需要java 8.0 以上版本。</p>
<p><a href="https://docs.oracle.com/en/java/javase/15/install/installation-jdk-microsoft-windows-platforms.html">官方安装教程</a></p>
<p>jdk1.8<a href="https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html">下载地址</a></p>
<p>如果官网下载搞不定可以下载百度云盘分享的安装文件（windows版本）</p>
<p>链接：https://pan.baidu.com/s/1emFwU46DB-jJaZxtRt4-YA 提取码：h6b8</p>
<h5 id="112-java环境变量设置">1.1.2 java环境变量设置</h5>
<p>创建环境变量<code>JAVA_HOME</code>设置期值为jdk的根目录<br>
<img src="https://Shisuiyi.github.io/post-images/1639801549572.png" alt="" loading="lazy"></p>
<p>在环境变量PATH中添加jdk中的bin目录<br>
<img src="https://Shisuiyi.github.io/post-images/1639801556872.png" alt="" loading="lazy"></p>
<p>在命令行中输入 java - version输出当前版本号表示环境搭建成功：<br>
<img src="https://Shisuiyi.github.io/post-images/1639801569335.png" alt="" loading="lazy"></p>
<h4 id="12-jenkins安装">1.2 jenkins安装</h4>
<h5 id="121-windows系统下安装">1.2.1 windows系统下安装</h5>
<ul>
<li>使用安装程序 <a href="http://mirrors.jenkins.io/windows/latest">下载最新安装包</a></li>
<li>打开安装包按照说明操作</li>
</ul>
<h5 id="122-mac下安装">1.2.2 mac下安装</h5>
<p>使用安装程序安装：</p>
<ul>
<li>使用按照程序<a href="http://mirrors.jenkins.io/osx/latest">下载最新安装包</a></li>
<li>打开安装包按照说明操作</li>
</ul>
<p>使用<code>brew</code>的方式安装</p>
<ul>
<li><code>brew install jenkins</code></li>
</ul>
<p>上面的两种方式都是以服务的方式安装，还可以以脚本的方式安装，以命令的方式启动</p>
<h5 id="123-脚本方式安装">1.2.3 脚本方式安装</h5>
<ol>
<li><a href="http://mirrors.jenkins.io/war-stable/latest/jenkins.war">下载 Jenkins war包.</a></li>
<li>打开终端进入到下载目录.</li>
<li>运行命令 <code>java -jar jenkins.war --httpPort=8080</code>.</li>
<li>打开浏览器进入链接 <a href="http://localhost:8080/">http://localhost:8080</a>.</li>
<li>按照说明完成安装.</li>
</ol>
<p>建议：</p>
<p>win10 家庭版不要安装成系统服务，可能会出现各种问题</p>
<p>关闭各种杀毒，防火墙之类的软件，可能会导致不能正常安装</p>
<h5 id="124-傻瓜脚本式">1.2.4 傻瓜脚本式</h5>
<p>如果实在是安装不成功，可以下载我提供的免安装版，注意 jenkins 依赖 Java 环境，所以要提前安装 JDK</p>
<p>链接：https://pan.baidu.com/s/1tg9mRXezx7MwviC9jNERsw 提取码：vbjh</p>
<p>下载后解压在非中文路径下，然后双击 jenkins.exe 程序即可，后面要使用的插件都下载好了，当然这只是供大家学习。生产环境下会部署到 Linux 服务器上。</p>
<h3 id="2-jenkins使用">2. jenkins使用</h3>
<p>后续内容见博客 http://testingpai.com/article/1609225132204<br>
<img src="https://Shisuiyi.github.io/post-images/1639801582075.png" alt="" loading="lazy"></p>
<h3 id="21-解锁-jenkins">2.1 解锁 Jenkins</h3>
<p>安装好 jenkins 首次进入时，你会看到如下页面</p>
<figure data-type="image" tabindex="2"><img src="https://Shisuiyi.github.io/post-images/1639823814998.png" alt="" loading="lazy"></figure>
<p>按照页面上的路径找到初始化管理员密码，这个文件没有后缀，所以 <strong>windows 系统的童靴不要双击</strong>，右键使用记事本或者任意的文本编辑工具打开即可。复制密码填入输入框点击继续。</p>
<p>jenkins 接下来会连接网络(会连接外网)，如果你的电脑不能连接网络，将会打开如下页面：</p>
<figure data-type="image" tabindex="3"><img src="https://Shisuiyi.github.io/post-images/1639823835264.png" alt="" loading="lazy"></figure>
<p>尽量不要出现安装时断网的情况，如果其他软件都可以访问互联网，还是出现这个页面，请尝试科学上网后再重复这个步骤。</p>
<h3 id="22-安装插件">2.2 安装插件</h3>
<p>正常情况下，填完管理员密码后会打开如下页面：</p>
<figure data-type="image" tabindex="4"><img src="https://Shisuiyi.github.io/post-images/1639823853963.png" alt="" loading="lazy"></figure>
<p>点击安装推荐的插件，会跳转到下面的页面：</p>
<figure data-type="image" tabindex="5"><img src="https://Shisuiyi.github.io/post-images/1639823886612.png" alt="" loading="lazy"></figure>
<p>jenkins 会自动安装页面中显示的插件，根据你的网络情况，这个过程会持续数分钟。</p>
<h3 id="23-创建第一个管理员用户">2.3 创建第一个管理员用户</h3>
<p>插件安装完后会自动跳入管理员创建页面：</p>
<p><img src="https://Shisuiyi.github.io/post-images/1639823912215.png" alt="" loading="lazy"><br>
填写管理员信息后点击保存并完成。</p>
<h3 id="24-配置-jenkins-url">2.4 配置 Jenkins URL</h3>
<p>Jenkins URL 用于给各种 Jenkins 资源提供绝对路径链接的根地址。 这意味着对于很多 Jenkins 特色是需要正确设置的，例如：邮件通知、PR 状态更新以及提供给构建步骤的 <code>BUILD_URL</code> 环境变量。<br>
<img src="https://Shisuiyi.github.io/post-images/1639823968283.png" alt="" loading="lazy"></p>
<p>学习时，我们使用默认值即可，点击保存并完成，会出现 Jenkins 已就绪的页面。</p>
<figure data-type="image" tabindex="6"><img src="https://Shisuiyi.github.io/post-images/1639823977735.png" alt="" loading="lazy"></figure>
<p>点击开始使用 Jenkins 会进入 Jenkins 管理的首页面，至此初始化工作完成。</p>
<h2 id="3-配置插件升级站点国内镜像">3. 配置插件升级站点国内镜像</h2>
<p>后面我们会用到很多插件，而 jenkins 默认的插件升级站点是外网，经常会连不上或者速度非常慢，我们可以配置成国内的镜像。</p>
<p>进入 <strong>Manage Jenkins</strong> &gt; <strong>Manage Plugins</strong> &gt; <strong>Advance(高级)</strong></p>
<figure data-type="image" tabindex="7"><img src="https://Shisuiyi.github.io/post-images/1639823989473.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="8"><img src="https://Shisuiyi.github.io/post-images/1639823999513.png" alt="" loading="lazy"></figure>
<p>滚动到页面底部</p>
<figure data-type="image" tabindex="9"><img src="https://Shisuiyi.github.io/post-images/1639824009791.png" alt="" loading="lazy"></figure>
<p>将升级站点改成：<code>https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</code></p>
<p>然后点击提交， 然后点击立即获取，如果正常页面会刷新，立即获取按钮前会出现<strong>多少秒之前获取更新信息</strong>的字样。</p>
<figure data-type="image" tabindex="10"><img src="https://Shisuiyi.github.io/post-images/1639824220357.png" alt="" loading="lazy"></figure>
<p>也有一些文章提示还要去配置 JSON 文件中替换 <a href="http://testingpai.com/forward?goto=http%3A%2F%2Fwww.google.com">www.google.com</a> 等，如果你只配置了升级站点不成功可以尝试。</p>
<p>在 Jenkins2.270 版本上，只配置升级站点即可。</p>
<h2 id="4-创建-python-自动化项目">4. 创建 python 自动化项目</h2>
<h3 id="41-新建-item">4.1 新建 item</h3>
<p>点击 jenkins 首页面的<strong>新建 Item</strong></p>
<figure data-type="image" tabindex="11"><img src="https://Shisuiyi.github.io/post-images/1639824249629.png" alt="" loading="lazy"></figure>
<p>在打开的页面中输入项目名称，选择 <strong>Freestyle project</strong>(自由风格项目)，再点击确认，进入项目配置页面。</p>
<figure data-type="image" tabindex="12"><img src="https://Shisuiyi.github.io/post-images/1639824266600.png" alt="" loading="lazy"></figure>
<h3 id="42-general-配置">4.2 General 配置</h3>
<p>General 配置中有很多选项，每个选项的后面有问号，点击会介绍当前选项的作用，都是见名思议，后面的配置也是如此。<br>
<img src="https://Shisuiyi.github.io/post-images/1639824279508.png" alt="" loading="lazy"></p>
<p>为了学习简单，我们演示的项目配置为本地项目。点击高级，选中<strong>使用自定义的工作空间</strong>，在目录中填入项目的根目录绝对路径。</p>
<figure data-type="image" tabindex="13"><img src="https://Shisuiyi.github.io/post-images/1639824319784.png" alt="" loading="lazy"></figure>
<p>这个目录就是工作空间目录，后面很多配置都是以这个路径为标准使用相对路径来配置。</p>
<h3 id="43-源码管理">4.3 源码管理</h3>
<p>我们这里配置了自定义工作空间，这里就勾选无，如果是想配置 Git 管理的远程仓库就勾选 Git。<br>
<img src="https://Shisuiyi.github.io/post-images/1639824331726.png" alt="" loading="lazy"></p>
<p>勾选了远程仓库 jenkins 会从仓库下载代码到本地工作空间，默认在 <code>.jenkins\workspace</code> 下以项目名作为名字的文件夹中。</p>
<h3 id="44-构建触发器">4.4 构建触发器</h3>
<p>所谓触发器就是设置自动运行项目的条件。有多种方式，这里我们选择使用定时构建。</p>
<figure data-type="image" tabindex="14"><img src="https://Shisuiyi.github.io/post-images/1639824361227.png" alt="" loading="lazy"></figure>
<p>勾选 <strong>Build periodically</strong>，点击问号有设置详细说明</p>
<figure data-type="image" tabindex="15"><img src="https://Shisuiyi.github.io/post-images/1639824372971.png" alt="" loading="lazy"></figure>
<p>我们设置日程表为 <code>H 23 * * *</code>，表示每天晚上 23 点到 24 点间随机一个时间进行构建。插件推荐使用 H 来模糊指定，而不是精确指定具体时间，造成构建任务过于集中。</p>
<h3 id="45-构建环境">4.5 构建环境</h3>
<p>我们当前的项目不需要额外的构建环境，为了在控制台中显示时间戳，可以勾选 <strong>Add timestamps to the Console Output</strong>，其他的按需设置。</p>
<figure data-type="image" tabindex="16"><img src="https://Shisuiyi.github.io/post-images/1639824384709.png" alt="" loading="lazy"></figure>
<h3 id="46-构建">4.6 构建</h3>
<p>构建就是启动项目，其实本质上就是启动项目执行的命令。点开<strong>增加构建步骤</strong>按钮后，会出现多个选项</p>
<p><img src="https://Shisuiyi.github.io/post-images/1639824395423.png" alt="" loading="lazy"><br>
对于 python 项目来说，一般只会用到两个：</p>
<ol>
<li><strong>Execute Windows batch command</strong> 执行 windows 批处理命令</li>
<li><strong>Execute shell</strong> 执行 shell 命令(mac,linux)</li>
</ol>
<p>这里我们选择执行 windows 批处理命令，然后在输入框中输入启动项目的命令，可以执行多条命令。注意，这里的命令当前路径为工作空间。</p>
<figure data-type="image" tabindex="17"><img src="https://Shisuiyi.github.io/post-images/1639824409730.png" alt="" loading="lazy"></figure>
<p>这样，一个 python 项目的基本配置就完成了，点击保存。然后点击项目管理首页左侧的 <strong>BuildNow</strong> 进行第一次构建，检查配置是否正确。</p>
<figure data-type="image" tabindex="18"><img src="https://Shisuiyi.github.io/post-images/1639824481906.png" alt="" loading="lazy"></figure>
<p>构建完成后，结果是否正确，会在构建序号前通过不同颜色的小球来表示，蓝色表示成功，红色表示失败，黄色表示警告，这个跟构建命令的方式有关。</p>
<p><img src="https://Shisuiyi.github.io/post-images/1639824493521.png" alt="" loading="lazy"><br>
点击构建序号，进入具体构建的管理页面，可以查看控制台输出，查看日志来调试。</p>
<figure data-type="image" tabindex="19"><img src="https://Shisuiyi.github.io/post-images/1639824506373.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="20"><img src="https://Shisuiyi.github.io/post-images/1639824519526.png" alt="" loading="lazy"></figure>
<h2 id="5-配置-html-报告">5. 配置 HTML 报告</h2>
<p>如果你的项目单独生成了 HTML 格式的报告，想要在 jenkins 上发布报告需要安装 HTML 发布插件。</p>
<h3 id="51-安装-html-publisher-插件">5.1 安装 HTML Publisher 插件</h3>
<p>点击 <strong>Manage Jenkins &gt; Manage Plugins &gt; 可选插件</strong>，搜索 <strong>HTML</strong>，选择 <strong>HTML Publisher</strong>，点击 <strong>install without restart</strong></p>
<p><img src="https://Shisuiyi.github.io/post-images/1639824552006.png" alt="" loading="lazy"><br>
开始安装</p>
<figure data-type="image" tabindex="21"><img src="https://Shisuiyi.github.io/post-images/1639824563431.png" alt="" loading="lazy"></figure>
<p>如果前面升级镜像配置 ok，然后人品够好的话，很快就安装好了</p>
<figure data-type="image" tabindex="22"><img src="https://Shisuiyi.github.io/post-images/1639824578661.png" alt="" loading="lazy"></figure>
<h3 id="52-配置-html-publisher-插件">5.2 配置 HTML Publisher 插件</h3>
<p>进入对应项目管理页面，点击<strong>配置</strong> &gt; <strong>构建后操作</strong> &gt; <strong>增加构建后操作步骤</strong>，在打开的弹框中选择 <strong>Publish HTML reports</strong>，</p>
<figure data-type="image" tabindex="23"><img src="https://Shisuiyi.github.io/post-images/1639824593924.png" alt="" loading="lazy"></figure>
<p>点击新增</p>
<figure data-type="image" tabindex="24"><img src="https://Shisuiyi.github.io/post-images/1639824607138.png" alt="" loading="lazy"></figure>
<p>然后在 <strong>HTML directory to archive</strong> 中填写 HTML 报告的相对路径(相对工作空间)</p>
<figure data-type="image" tabindex="25"><img src="https://Shisuiyi.github.io/post-images/1639824620947.png" alt="" loading="lazy"></figure>
<p>再在**Index page[s]**中填写报告文件名，可以填写具体报告文件名，也可以使用 Ant patterns</p>
<figure data-type="image" tabindex="26"><img src="https://Shisuiyi.github.io/post-images/1639824634905.png" alt="" loading="lazy"></figure>
<p>这里我们填写***.html**表示所有的 HTML 为后缀的文件。</p>
<p>最后保存配置。</p>
<h3 id="53-查看-html-报告">5.3 查看 HTML 报告</h3>
<p>再次构建项目，然后刷新项目管理页面，会在工作区上多了一个 <strong>HTML Peport</strong> 的选项，点击即可查看 HTML 报告</p>
<figure data-type="image" tabindex="27"><img src="https://Shisuiyi.github.io/post-images/1639824649428.png" alt="" loading="lazy"></figure>
<figure data-type="image" tabindex="28"><img src="https://Shisuiyi.github.io/post-images/1639824694264.png" alt="" loading="lazy"></figure>
<h3 id="54-配置-csp">5.4 配置 csp</h3>
<p>我们会发现 HTML 报告中的样式丢失了，原因是 Jenkins 中的 CSP(Content Security Policy，内容安全策略)的默认配置为一个非常严格的权限集，以防止 Jenkins 用户受到恶意的 HTML/JS 文件的攻击。</p>
<p>默认，该权限集会设置为：</p>
<pre><code> sandbox; **default**-src 'none'; img-src 'self'; style-src 'self';
</code></pre>
<p>在这个配置下，只允许加载：</p>
<ol>
<li>Jenkins 服务器上托管的 css/js 文件</li>
<li>Jenkins 服务器上托管的图片文件</li>
</ol>
<p>如下形式的内容都会被禁止：</p>
<ol>
<li>JavaScript</li>
<li>plugins</li>
<li>HTML 中的内联样式，以及引用外站的 CSS 文件</li>
<li>HTML 中的内联图片</li>
<li>frames</li>
<li>Web fonts</li>
<li>AJAX</li>
<li>...</li>
</ol>
<p>非常严格，所以我们的 HTML 报告没法正常展示样式了。</p>
<p>要解决该问题，就是修改 <code>csp</code> 的默认配置。</p>
<p>我们有两种方案来解决这个问题：</p>
<h4 id="541-临时解决">5.4.1 临时解决</h4>
<p>进入 <strong>Mange Jenkins &gt; Script console</strong></p>
<figure data-type="image" tabindex="29"><img src="https://Shisuiyi.github.io/post-images/1639824709340.png" alt="" loading="lazy"></figure>
<p>输入如下命令，并点击运行</p>
<pre><code>System.setProperty(&quot;hudson.model.DirectoryBrowserSupport.CSP&quot;, &quot;&quot;)
</code></pre>
<figure data-type="image" tabindex="30"><img src="https://Shisuiyi.github.io/post-images/1639824723365.png" alt="" loading="lazy"></figure>
<p>如果出现 resut 表示执行成功</p>
<figure data-type="image" tabindex="31"><img src="https://Shisuiyi.github.io/post-images/1639824737700.png" alt="" loading="lazy"></figure>
<p>再次进行构建，新生成的 HTML 报告就可以正常展示样式了。注意之前构建生成的 HTML 报告依旧无效。且 jenkins 服务重启后，csp 会恢复默认。</p>
<h4 id="542-永久解决">5.4.2 永久解决</h4>
<p>当前 jenkins 没有提供配置来解决此问题，我们只有在每次启动 Jenkins 时重新修改该安全策略。windows 下 jenkins 安装目录下有一个 <code>jenkins.xml</code> 文件(其他方式请查找对应的配置文件)，</p>
<figure data-type="image" tabindex="32"><img src="https://Shisuiyi.github.io/post-images/1639824754223.png" alt="" loading="lazy"></figure>
<p>里面包含 jenkins 启动命令，我们可以在 <code>&lt;arguments&gt;</code> 标签中添加 csp 的设置参数，注意设置在 <code>-jar</code> 之前，改之前记得备份这个文件，防止修改错误。</p>
<p><img src="https://Shisuiyi.github.io/post-images/1639824765969.png" alt="" loading="lazy"><br>
在临时方案中我们修改了 <code>csp</code> 为空，表示关闭了内容安全策略，这其实存在很大的安全隐患，正确的做法，我们应该结合项目的实际情况，选择对应的安全策略。例如，我们的 HTML 报告中使用了百度的 cdn 加速，所以需要配置运行加载对应域名的 CSS 样式，所以配置如下：</p>
<pre><code>-Dhudson.model.DirectoryBrowserSupport.CSP=&quot;sandbox; style-src 'self' libs.baidu.com;&quot;
</code></pre>
<p>除此之外，csp 还有很多精细的配置，详细配置可参考<a href="http://testingpai.com/forward?goto=https%3A%2F%2Fcontent-security-policy.com%2F"><code>Content Security Policy Reference</code></a>。</p>
<p>配置好后，重启服务，如果出现启动失败，检查是否配置错误，前后空格，表点符号。完整的 arguments 的配置如下：</p>
<pre><code>  &lt;arguments&gt;-Xrs -Xmx256m -Dhudson.lifecycle=hudson.lifecycle.WindowsServiceLifecycle -Dhudson.model.DirectoryBrowserSupport.CSP=&quot;sandbox; style-src 'self' libs.baidu.com;&quot; -jar &quot;D:\Program Files\Jenkins\jenkins.war&quot; --httpPort=9090 --webroot=&quot;D:\Program Files\Jenkins\war&quot;&lt;/arguments&gt;
</code></pre>
<p>注意：不要复制里面的 war 文件，webroot 的路径，要结合你自己的项目。</p>
<p>按照这种方案重启后，所有的 HTML 报告样式都可以正常显示。</p>
<p>如果是下载我提供的免安装版的 jenkins，修改目录下的 <code>config.yaml</code> 文件中的 csp 配置即可</p>
<p><img src="https://Shisuiyi.github.io/post-images/1639824792162.png" alt="" loading="lazy"><br>
<img src="https://Shisuiyi.github.io/post-images/1639824805814.png" alt="" loading="lazy"></p>
<h4 id="543-通过-jenkins-插件实现">5.4.3 通过 jenkins 插件实现</h4>
<ol>
<li>
<p>安装插件 Startup Trigger: 可实现在 Jenkins 节点(master/slave)启动时触发构建</p>
</li>
<li>
<p>安装插件 Groovy plugin: 可实现直接执行 Groovy 代码</p>
</li>
<li>
<p>来到任务配置页面在“构建触发器(Build Triggers)”模块，选择“Buildwhen job nodes start”选项</p>
</li>
<li>
<p>在“构建（Build）”模块，选择“Execute system Groovy script”，执行如下 Groovy 命令：System.setProperty(&quot;hudson.model.DirectoryBrowserSupport.CSP&quot;,&quot;&quot;)<br>
<img src="https://Shisuiyi.github.io/post-images/1639824853515.png" alt="" loading="lazy"><br>
<img src="https://Shisuiyi.github.io/post-images/1639824863042.png" alt="" loading="lazy"><br>
<img src="https://Shisuiyi.github.io/post-images/1639824879008.png" alt="" loading="lazy"></p>
</li>
<li>
<p>保存配置，重新构建生效</p>
</li>
</ol>
<h2 id="6-配置邮件">6. 配置邮件</h2>
<p>构建后，我们往往需要通过发邮件的形式通知相应人员。jenkins 的默认的邮件只有构建失败时才会发送邮件，且不支持自定义邮件内容。所以需要安装插件**<a href="http://testingpai.com/forward?goto=https%3A%2F%2Fplugins.jenkins.io%2Femail-ext">Email Extension Plugin</a>**，然后配置邮件</p>
<h3 id="61-配置管理员邮箱">6.1 配置管理员邮箱</h3>
<p>进入 <strong>Manage Jenkins&gt;Configure System&gt; 系统管理员邮件地址</strong>，填写你用来发送邮件的邮箱。</p>
<figure data-type="image" tabindex="33"><img src="https://Shisuiyi.github.io/post-images/1639824894291.png" alt="" loading="lazy"></figure>
<h3 id="62-配置-jenkins-默认邮件通知">6.2 配置 jenkins 默认邮件通知</h3>
<p>继续往下滚动到最后，配置邮件通知，点击高级展开所有选项，详细配置如下：<br>
<img src="https://Shisuiyi.github.io/post-images/1639824910888.png" alt="" loading="lazy"></p>
<p>配置好后，点击最下面的<strong>通过发送测试邮件测试配置</strong>来检查是否配置成功。</p>
<p><img src="https://Shisuiyi.github.io/post-images/1639824927127.png" alt="" loading="lazy"><br>
如果能够收到邮件表示邮件通知配置成功。现在先保存一下。</p>
<h3 id="63-配置-email-extension-plugin">6.3 配置 Email Extension Plugin</h3>
<p>进入 <strong>Manage Jenkins&gt;Configure System&gt;Extended E-mail Notification</strong>，同样点击高级展开高级配置选项，详细配置如下：</p>
<figure data-type="image" tabindex="34"><img src="https://Shisuiyi.github.io/post-images/1639824942471.png" alt="" loading="lazy"></figure>
<p>往下翻到最后有一个触发配置，默认是失败触发，<br>
<img src="https://Shisuiyi.github.io/post-images/1639825018169.png" alt="" loading="lazy"></p>
<p>点击按钮展开配置，选择 always</p>
<figure data-type="image" tabindex="35"><img src="https://Shisuiyi.github.io/post-images/1639825051964.png" alt="" loading="lazy"></figure>
<p>保存。</p>
<h3 id="64-在项目中配置发送邮件">6.4 在项目中配置发送邮件</h3>
<p>进入项目配置页面，点击<strong>增加构建后操作步骤</strong>，选择 <strong>Editable Email Notification</strong></p>
<figure data-type="image" tabindex="36"><img src="https://Shisuiyi.github.io/post-images/1639825066052.png" alt="" loading="lazy"></figure>
<p>配置发件邮箱和收件邮箱，收件邮箱如果有多个可以用逗号隔开</p>
<figure data-type="image" tabindex="37"><img src="https://Shisuiyi.github.io/post-images/1639825080961.png" alt="" loading="lazy"></figure>
<p>保存后，构建测试测试是否发送邮件。如果不成功，可以在构建日志中查看失败原因，然后重复上面的步骤。</p>
<h3 id="65-发送-html-格式内容的邮件">6.5 发送 HTML 格式内容的邮件</h3>
<p><strong>Email Extension Plugin</strong> 插件支持 HTML 格式的内容。</p>
<p>再次进入项目配置页面，来到邮件服务配置项，设置 <strong>Content Type</strong> 为 HTML<br>
<img src="https://Shisuiyi.github.io/post-images/1639825096347.png" alt="" loading="lazy"></p>
<p>然后在 <strong>Default Content</strong> 可以写入 HTML 模板，并且模板中可以使用 jenkins 对应的环境变量。</p>
<figure data-type="image" tabindex="38"><img src="https://Shisuiyi.github.io/post-images/1639825108685.png" alt="" loading="lazy"></figure>
<p>例如我使用的模板效果如下：</p>
<figure data-type="image" tabindex="39"><img src="https://Shisuiyi.github.io/post-images/1639825121236.png" alt="" loading="lazy"></figure>

        </div>

        
          <a class="animated fadeInUp p-2 items-center text-sm text-gray-700 border hover:bg-gray-300 leading-none rounded-full flex lg:inline-flex m-4 " href="https://Shisuiyi.github.io/5qEy9suH_/">
            <span class="flex-auto">jenkins</span>
          </a>
        


        <div class="flex justify-between py-8">
          
            <div class="prev-post">
              <a href="https://Shisuiyi.github.io/KuEeiRaTl/">
                <h3 class="post-title">
                  <i class="ri-arrow-left-line"></i>
                  Git
                </h3>
              </a>
            </div>
          

          
            <div class="next-post">
              <a href="https://Shisuiyi.github.io/4-zRzmkp0/">
                <h3 class="post-title">
                   mock测试
                  <i class="ri-arrow-right-line"></i>
                </h3>
              </a>
            </div>
          
        </div>

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: '978584b9702b5d850dd5',
    clientSecret: 'b6647706cb7b990e2cd5ca77eccf73943df73a6c',
    repo: 'Shisuiyi.github.io',
    owner: 'shisuiyi',
    admin: ['shisuiyi'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

      </div>
    </div>

    <script src="https://Shisuiyi.github.io/media/prism.js"></script>  
<script>

Prism.highlightAll()
let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

// This should probably be throttled.
// Especially because it triggers during smooth scrolling.
// https://lodash.com/docs/4.17.10#throttle
// You could do like...
// window.addEventListener("scroll", () => {
//    _.throttle(doThatStuff, 100);
// });
// Only not doing it here to keep this Pen dependency-free.

window.addEventListener("scroll", event => {
  let fromTop = window.scrollY;

  mainNavLinks.forEach((link, index) => {
    let section = document.getElementById(decodeURI(link.hash).substring(1));
    let nextSection = null
    if (mainNavLinks[index + 1]) {
      nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
    }
    if (section.offsetTop <= fromTop) {
      if (nextSection) {
        if (nextSection.offsetTop > fromTop) {
          link.classList.add("current");
        } else {
          link.classList.remove("current");    
        }
      } else {
        link.classList.add("current");
      }
    } else {
      link.classList.remove("current");
    }
  });
});


document.addEventListener("DOMContentLoaded", function() {
  var lazyImages = [].slice.call(document.querySelectorAll(".post-feature-image.lazy"));

  if ("IntersectionObserver" in window) {
    let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          let lazyImage = entry.target
          lazyImage.style.backgroundImage = `url(${lazyImage.dataset.bg})`
          lazyImage.classList.remove("lazy")
          lazyImageObserver.unobserve(lazyImage)
        }
      });
    });

    lazyImages.forEach(function(lazyImage) {
      lazyImageObserver.observe(lazyImage)
    })
  } else {
    // Possibly fall back to a more compatible method here
  }
});

const menuContainer = document.querySelector('.menu-container')
const menus = document.querySelectorAll('.menu-container .menu')
const mask = document.querySelector('.mask')
const contentWrapper = document.querySelector('.content-wrapper')
const latestArticle = document.querySelector('.latest-article')
const readMore = document.querySelector('.read-more')
const indexPage = document.querySelector('.index-page')

const isHome = location.pathname === '/'
if (latestArticle) {
  latestArticle.style.display = isHome ? 'block' : 'none'
  readMore.style.display = isHome ? 'block' : 'none'
  indexPage.style.display = isHome ? 'none' : 'block'
}

const openMenu = () => {
  menuContainer.classList.add('open')
  menus.forEach(menu => {
    menu.classList.add('animated', 'fadeInLeft')
  })
  mask.classList.add('open')
  contentWrapper.classList.add('is-second')
}

const closeMenu = () => {
  menuContainer.classList.remove('open')
  menus.forEach(menu => {
    menu.classList.remove('animated', 'fadeInLeft')
  })
  mask.classList.remove('open')
  contentWrapper.classList.remove('is-second')
}
</script>
  
  </body>
</html>
